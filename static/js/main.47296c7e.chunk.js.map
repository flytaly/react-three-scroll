{"version":3,"sources":["img/img1.jpg","img/img2.jpg","img/img3.jpg","store.js","blocks.js","components/plane.js","components/cube.js","components/pages.js","app.js","index.js"],"names":["module","exports","state","sections","pages","zoom","top","createRef","images","img1","img2","img3","offsetContext","createContext","Block","children","offset","factor","props","useBlock","parentOffset","sectionHeight","ref","useRef","undefined","useFrame","curY","current","position","y","curTop","lerp","Provider","value","useThree","size","viewport","useContext","viewportWidth","width","viewportHeight","height","canvasWidth","canvasHeight","mobile","margin","contentMaxWidth","offsetFactor","Plane","color","map","material","last","scale","shift","attach","args","Box","Cube","rotation","z","totalHeight","nextY","Math","PI","rateY","rightX","leftX","rateX","pageNum","floor","x","Euler","Content","left","alignRight","Stripe","Pages","textures","useLoader","TextureLoader","console","log","texture","minFilter","LinearFilter","w","pixelWidth","style","textAlign","zIndex","prepend","Startup","opacity","transparent","App","scrollArea","onScroll","e","target","scrollTop","useEffect","className","orthographic","camera","fallback","center","ReactDOM","render","document","getElementById"],"mappings":"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","file":"static/js/main.47296c7e.chunk.js","sourcesContent":["module.exports = __webpack_public_path__ + \"static/media/img1.92865698.jpg\";","module.exports = __webpack_public_path__ + \"static/media/img2.7f16909d.jpg\";","module.exports = __webpack_public_path__ + \"static/media/img3.5f702444.jpg\";","import { createRef } from 'react';\nimport img1 from './img/img1.jpg';\nimport img2 from './img/img2.jpg';\nimport img3 from './img/img3.jpg';\n\nconst state = {\n  sections: 3,\n  pages: 3,\n  zoom: 75,\n  top: createRef(),\n  images: [img1, img2, img3],\n};\n\nexport default state;\n","import React, { createContext, useRef, useContext } from 'react';\nimport { useFrame, useThree } from 'react-three-fiber';\nimport lerp from 'lerp';\nimport state from './store';\n\nconst offsetContext = createContext(0);\n\nfunction Block({ children, offset, factor, ...props }) {\n  const { offset: parentOffset, sectionHeight } = useBlock();\n  const ref = useRef();\n  offset = offset !== undefined ? offset : parentOffset;\n  useFrame(() => {\n    const curY = ref.current.position.y;\n    const curTop = state.top.current;\n    ref.current.position.y = lerp(curY, (curTop / state.zoom) * factor, 0.1);\n  });\n  return (\n    <offsetContext.Provider value={offset}>\n      <group {...props} position={[0, -sectionHeight * offset * factor, 0]}>\n        <group ref={ref}>{children}</group>\n      </group>\n    </offsetContext.Provider>\n  );\n}\n\nfunction useBlock() {\n  const { sections, pages, zoom } = state;\n  const { size, viewport } = useThree();\n  const offset = useContext(offsetContext);\n  const viewportWidth = viewport.width;\n  const viewportHeight = viewport.height;\n  const canvasWidth = viewportWidth / zoom;\n  const canvasHeight = viewportHeight / zoom;\n  const mobile = size.width < 700;\n  const margin = canvasWidth * (mobile ? 0.2 : 0.1);\n  const contentMaxWidth = canvasWidth * (mobile ? 0.8 : 0.6);\n  const sectionHeight = canvasHeight * ((pages - 1) / (sections - 1));\n\n  const offsetFactor = (offset + 1.0) / sections;\n  return {\n    viewport,\n    offset,\n    viewportWidth,\n    viewportHeight,\n    canvasWidth,\n    canvasHeight,\n    mobile,\n    margin,\n    contentMaxWidth,\n    sectionHeight,\n    offsetFactor,\n  };\n}\n\nexport { Block, useBlock };\n","import React, { useRef } from 'react';\nimport { useFrame } from 'react-three-fiber';\nimport state from '../store';\nimport { useBlock } from '../blocks';\nimport lerp from 'lerp';\n\nfunction Plane({ color = 'white', map, ...props }) {\n  const { viewportHeight, offsetFactor } = useBlock();\n  const material = useRef();\n  let last = state.top.current;\n  useFrame(() => {\n    const { pages, top } = state;\n    material.current.scale = lerp(material.current.scale, offsetFactor - top.current / ((pages - 1) * viewportHeight), 0.1);\n    material.current.shift = lerp(material.current.shift, (top.current - last) / 150, 0.1);\n    last = top.current;\n  });\n  return (\n    <mesh {...props}>\n      <planeBufferGeometry attach=\"geometry\" args={[1, 1, 32, 32]} />\n      <meshBasicMaterial ref={material} attach=\"material\" color={color} map={map} />\n    </mesh>\n  );\n}\n\nexport default Plane;\n","import React, { useRef } from 'react';\nimport { useFrame } from 'react-three-fiber';\nimport { useBlock } from '../blocks';\nimport { Euler } from 'three';\nimport state from '../store';\nimport lerp from 'lerp';\n\nfunction Box({ color = 'black', ...props }) {\n  return (\n    <mesh {...props}>\n      <boxBufferGeometry attach=\"geometry\" args={[1, 1, 1]} />\n      <meshNormalMaterial attach=\"material\" color={color} />\n    </mesh>\n  );\n}\n\nconst Cube = ({ position = [0, 0, 2] }) => {\n  const ref = useRef();\n  const { viewportHeight, contentMaxWidth, canvasHeight } = useBlock();\n  useFrame(() => {\n    const curTop = state.top.current;\n\n    const curY = ref.current.rotation.z;\n    const totalHeight = (state.pages - 1) * viewportHeight;\n    const nextY = 2 * (curTop / totalHeight) * Math.PI;\n    const rateY = lerp(curY, nextY, 0.1);\n\n    const rightX = contentMaxWidth / 2;\n    const leftX = -rightX;\n    const rateX = curTop / viewportHeight;\n    const pageNum = Math.floor(rateX);\n    if (pageNum % 2 === 0) {\n      // move to left\n      ref.current.position.x = lerp(rightX, leftX, rateX - pageNum);\n    } else {\n      // move to right\n      ref.current.position.x = lerp(leftX, rightX, rateX - pageNum);\n    }\n    ref.current.position.y = lerp(canvasHeight / 2 - 1, -canvasHeight / 2 + 1, curTop / totalHeight);\n    ref.current.rotation.x = rateY;\n    ref.current.rotation.z = rateY;\n  });\n\n  return (\n    <group ref={ref} scale={[2, 2, 2]} position={position}>\n      <Box scale={[0.3, 0.3, 0.3]} rotation={new Euler(0.5, 0.5, 0)} />\n    </group>\n  );\n};\n\nexport default Cube;\n","import React from 'react';\nimport { Dom, useLoader } from 'react-three-fiber';\nimport { TextureLoader, LinearFilter } from 'three';\nimport { Block, useBlock } from '../blocks';\nimport state from '../store';\nimport Plane from './plane';\nimport Cube from './cube';\n\nfunction Content({ left, children, map }) {\n  const { contentMaxWidth, canvasWidth, margin } = useBlock();\n  const aspect = 1.75;\n  const alignRight = (canvasWidth - contentMaxWidth - margin) / 2;\n  return (\n    <group position={[alignRight * (left ? -1 : 1), 0, 0]}>\n      <Plane scale={[contentMaxWidth, contentMaxWidth / aspect, 1]} color=\"#bfe2ca\" map={map} />\n      {children}\n    </group>\n  );\n}\n\nfunction Stripe() {\n  const { contentMaxWidth } = useBlock();\n  return <Plane scale={[100, contentMaxWidth, 1]} rotation={[0, 0, Math.PI / 4]} position={[0, 0, -1]} color=\"#555555\" />;\n}\n\nexport default function Pages() {\n  const textures = useLoader(TextureLoader, state.images);\n  console.log({ textures });\n\n  const [img1, img2, img3] = textures.map((texture) => {\n    texture.minFilter = LinearFilter;\n    return texture;\n  });\n  const { contentMaxWidth: w, canvasHeight, mobile } = useBlock();\n  const aspect = 1.75;\n\n  const pixelWidth = w * state.zoom;\n\n  return (\n    <>\n      {/* Cube */}\n      <Block factor={0} offset={0}>\n        <Cube position={[w / 2, canvasHeight / 2 - 1, 2]}></Cube>\n      </Block>\n      {/* First section */}\n      <Block factor={1.5} offset={0}>\n        <Content left map={img1}>\n          <Dom style={{ width: pixelWidth / (mobile ? 1 : 2), textAlign: 'left' }} position={[-w / 2, -w / 2 / aspect - 0.4, 1]}>\n            Image 1 text. DOM render\n          </Dom>\n        </Content>\n      </Block>\n      {/* Second section */}\n      <Block factor={2.0} offset={1}>\n        <Content map={img2} style={{ zIndex: 100 }}>\n          <Dom\n            prepend={false}\n            style={{\n              zIndex: 100,\n              width: pixelWidth / (mobile ? 1 : 2),\n              textAlign: 'right',\n            }}\n            position={[mobile ? -w / 2 : 0, -w / 2 / aspect - 0.4, 1]}\n          >\n            Image 2 text. DOM render\n          </Dom>\n        </Content>\n      </Block>\n      {/* Stripe */}\n      <Block factor={-1.0} offset={1}>\n        <Stripe />\n      </Block>\n      {/* Last section */}\n      <Block factor={1.5} offset={2}>\n        <Content left map={img3}>\n          <Dom prepend style={{ width: pixelWidth / (mobile ? 1 : 2), textAlign: 'left' }} position={[-w / 2, -w / 2 / aspect - 0.4, 1]}>\n            Image 3 text. DOM render\n          </Dom>\n        </Content>\n      </Block>\n    </>\n  );\n}\n","import React, { Suspense, useRef, useEffect } from 'react';\nimport { Canvas, Dom, useFrame } from 'react-three-fiber';\nimport state from './store';\nimport './styles.css';\nimport Pages from './components/pages';\nimport lerp from 'lerp';\n\nfunction Startup() {\n  const ref = useRef();\n  useFrame(() => (ref.current.material.opacity = lerp(ref.current.material.opacity, 0, 0.025)));\n  return (\n    <mesh ref={ref} position={[0, 0, 200]} scale={[100, 100, 1]}>\n      <planeBufferGeometry attach=\"geometry\" />\n      <meshBasicMaterial attach=\"material\" color=\"#dfdfdf\" transparent />\n    </mesh>\n  );\n}\n\nfunction App() {\n  const scrollArea = useRef();\n  const onScroll = (e) => (state.top.current = e.target.scrollTop);\n  useEffect(() => void onScroll({ target: scrollArea.current }), []);\n\n  return (\n    <>\n      <Canvas className=\"canvas\" orthographic camera={{ zoom: state.zoom, position: [0, 0, 500] }}>\n        <Suspense fallback={<Dom center className=\"loading\" children=\"Loading...\" />}>\n          <Pages />\n          <Startup />\n        </Suspense>\n      </Canvas>\n      <div className=\"scrollArea\" ref={scrollArea} onScroll={onScroll}>\n        <div style={{ height: `${state.pages * 100}vh` }} />\n      </div>\n    </>\n  );\n}\n\nexport default App;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport App from './app';\n\nReactDOM.render(<App />, document.getElementById('root'));\n"],"sourceRoot":""}